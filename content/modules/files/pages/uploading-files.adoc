= Uploading Files

In this section, we will show how to manage the file upload process from the UI and via the dedicated programmatic interfaces.
Consult the xref:rest:files-api.adoc[Files API] section to learn how to manage files through the REST API.

== UI Components

Jmix provides a set of UI components for files upload: xref:ui:vcl/components/file-upload-field.adoc[], xref:ui:vcl/components/file-multi-upload-field.adoc[], and xref:ui:vcl/components/file-storage-upload-field.adoc[].

For uploading a file from user interface xref:files:files-in-database.adoc[to DB], you can use the `FileUploadField` component bound to the entity attribute. If the file is an image, you can use the xref:ui:vcl/components/image.adoc[] component to display the image on the screen.

To upload a file from the userâ€™s computer to a xref:files:file-storage.adoc[file storage], use the `FileMultiUploadField` and `FileStorageUploadField` components.

By default, the upload component contains a caption, a link to the uploaded file, and an upload button:

image::file-storage-upload-field.png[align="center"]

When the upload button is clicked, a standard OS file picker window is shown, where the user can select a file. The uploaded file is displayed as a clickable link, by clicking on it the file is downloaded:

image::file-storage-upload-field-with-file.png[align="center"]

You can find the complete examples of working with these UI components in the components' documentation.

[[using-temporary-storage]]
== Using TemporaryStorage

The `FileStorageUploadField` component has the xref:ui:vcl/components/file-storage-upload-field.adoc#file-storage-put-mode[fileStoragePutMode] attribute with the default value `IMMEDIATE`. If you set it to `MANUAL`, the component uploads the file to the temporary storage in the file system of the application, and gives you full control over the uploaded file: you can transfer the file to the file storage as is, pre-process it, or do whatever you need with the file without saving it to the file storage at all.

The same is true for the xref:ui:vcl/components/file-multi-upload-field.adoc[FileMultiUploadField] component: it just uploads files to the temporary storage and notifies your code that the upload is complete.

The `TemporaryStorage` interface provides an API to create temporary files, save them to the file storage, or remove them.

Below is an example of using `FileStorageUploadField` in manual mode to transfer the uploaded file from temporary storage to the file storage.

[source,xml,indent=0]
----
include::example$/ex1/src/main/resources/files/ex1/screen/files/files-screen.xml[tags=put-mode-manual]
----
<1> Set `fileStoragePutMode="MANUAL"` for the upload field component.

[source,java,indent=0]
----
include::example$/ex1/src/main/java/files/ex1/screen/files/FilesScreen.java[tags=temporary-storage-1;temporary-storage-2]
----
<1> Get local file from the temporary storage using identifier provided by the upload field.
<2> Transfer local file to the file storage.

The `putFileIntoStorage()` method also removes the temporary local file.

If you only need to process the file locally without saving it to file storage, use the `deleteFile()` method of `TemporaryStorage` after working with the file, for example:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/files/ex1/screen/files/FilesScreen.java[tags=get-and-delete]
----

The temporary storage tends to accumulate files that were not deleted for various reasons. So it provides a JMX interface for removing such old unused files. You can find it by *jmix.ui:type=TemporaryStorage* name in *Administration -> JMX Console* screen. The MBean has the `clearTempDirectory()` method that removes all files from the temporary directory of the application (`.jmix/temp` by default) which are older than 2 days. You can call this method manually, or use a xref:quartz:index.adoc[Quartz] job to do it periodically. In a job, you should inject the `TemporaryStorageManagementFacade` bean and call its `clearTempDirectory()` method.
